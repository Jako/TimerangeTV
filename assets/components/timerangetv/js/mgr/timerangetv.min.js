/*!
 * TimerangeTV - Time range custom template variable
 * Version: 1.2.0
 * Build date: 2019-09-11
 */

var timerangetv=function(e){e=e||{},timerangetv.superclass.constructor.call(this,e)};Ext.extend(timerangetv,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},jquery:{},form:{}}),Ext.reg("timerangetv",timerangetv),TimerangeTV=new timerangetv,Ext.apply(Ext.form.VTypes,{timerange:function(e,t){var a=t.parseDate(e),n=a.format("Gi");if(!a)return!1;var i=Ext.getCmp(t.startTimeField),m=Ext.getCmp(t.endTimeField);return i&&(i.maxValue&&n===i.maxValue.format("Gi")||(i.setMaxValue(a),i.validate())),m&&(m.minValue&&n===m.minValue.format("Gi")||(m.setMinValue(a),m.validate())),!0}}),TimerangeTV.combo.TimerangeTV=function(e){e=e||{},Ext.applyIf(e,{xtype:"panel",layout:"column",autoHeight:!0,border:!1,width:400,items:[{xtype:"panel",columnWidth:.5,layout:"form",labelAlign:"top",border:!1,items:[new Ext.form.TimeField({fieldLabel:_("timerangetv.from"),name:"from"+e.tvId+"[]",id:"from"+e.tvId,format:e.timeFormat,increment:e.timeIncrement,minValue:e.minValue,maxValue:e.maxValue,enableKeyEvents:!0,allowBlank:e.allowBlank,value:e.timerangeStart,msgTarget:"under",vtype:"timerange",labelStyle:"padding-top:4px;",endTimeField:"to"+e.tvId,listeners:{change:{fn:this.timerangeOnChange,scope:this}}})]},{xtype:"panel",columnWidth:.5,layout:"form",labelAlign:"top",border:!1,items:[new Ext.form.TimeField({fieldLabel:_("timerangetv.to"),name:"to"+e.tvId+"[]",id:"to"+e.tvId,format:e.timeFormat,increment:e.timeIncrement,minValue:e.minValue,maxValue:e.maxValue,enableKeyEvents:!0,allowBlank:!0,value:e.timerangeEnd,msgTarget:"under",vtype:"timerange",labelStyle:"padding-top:4px;",startTimeField:"from"+e.tvId,listeners:{change:{fn:this.timerangeOnChange,scope:this}}})]}]}),TimerangeTV.combo.TimerangeTV.superclass.constructor.call(this,e)},Ext.extend(TimerangeTV.combo.TimerangeTV,MODx.Panel,{timerangeOnChange:function(){var e={from:Ext.getCmp("from"+this.config.tvId,this.config.timeFormat).getValue(),to:Ext.getCmp("to"+this.config.tvId,this.config.timeFormat).getValue()};this.setTVValue(e)},setTVValue:function(e){var t=this.getTVValue(),a="";e.from&&(a=e.from+"||",e.to&&(a+=e.to)),Ext.get("tv"+this.config.tvId).set({value:a}),t!==a&&MODx.fireResourceFormChange()},getTVValue:function(){return Ext.get("tv"+this.config.tvId).getValue()}}),Ext.reg("timerangetv-combo-timerangetv",TimerangeTV.combo.TimerangeTV),TimerangeTV.Renderer=function(e){if(!e.length)return"";var t=e.split("||"),a=1<=t.length&&new Date(t[0]),n=2<=t.length&&new Date(t[1]),i=MODx.config["timerangetv.time_format"]||MODx.config.manager_time_format,m=MODx.config["timerangetv.separator"]||"&thinsp;-&thinsp;",r="";return a&&a.getTime()&&(r=n&&n.getTime()&&a.getTime()!==n.getTime()?Ext.util.Format.date(a,i)+m+Ext.util.Format.date(n,i):Ext.util.Format.date(a,i)),r};